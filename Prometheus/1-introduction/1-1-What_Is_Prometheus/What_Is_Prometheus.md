![image](https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/Prometheus_software_logo.svg/220px-Prometheus_software_logo.svg.png)

---
## پرومتئوس چیست؟

**پرومتئوس** یک نرم‌افزار آزاد است که برای monitoring بر رویدادها و alerting استفاده می‌شود. این نرم‌افزار، متریک‌ها را در یک پایگاه داده سری زمانی با ابعاد بالا، با استفاده از مدل HTTP pull، با کوئری‌های انعطاف‌پذیر و alerting بلادرنگ، ثبت می‌کند. این پروژه با زبان Go نوشته شده است و تحت مجوز Apache 2 منتشر شده است، با کد منبع در دسترس در [GitHub](https://en.wikipedia.org/wiki/GitHub "GitHub")، و یک پروژه تایید شده از Cloud Native Computing Foundation (CNCF) همراه با Kubernetes و Envoy است.

---
### تاریخچه
پرومتئوس در سال 2012 در SoundCloud توسعه یافت، زمانی که این شرکت متوجه شد ابزارهای نظارت و متریک‌های موجود (با استفاده از StatsD و Graphite) برای نیازهای آن‌ها کافی نیست. به طور خاص، آن‌ها نیازهایی را شناسایی کردند که پرومتئوس برای برآوردن آن‌ها ساخته شده بود، از جمله یک مدل داده چند بعدی، سادگی عملیاتی، جمع‌آوری داده‌های مقیاس‌پذیر و یک زبان کوئری قدرتمند، همه در یک ابزار واحد. این پروژه از ابتدا متن‌باز بود و شروع به استفاده توسط کاربران Boxever و Docker نیز کرد، علی‌رغم اینکه به طور رسمی اعلام نشده بود.

---
 پرومتئوس از ابزار مانیتورینگ Borgmon استفاده شده در گوگل الهام گرفته شده بود.
تا سال 2013، پرومتئوس برای مانیتورینگ بر تولید در SoundCloud معرفی شد. اعلام عمومی رسمی در ژانویه 2015 انجام شد.
در ماه مه 2016، بنیاد محاسبات ابری بومی، پرومتئوس را به عنوان دومین پروژه در حال بررسی شده خود، پس از Kubernetes، پذیرفت. پست وبلاگی که این موضوع را اعلام کرد، بیان می‌کرد که این ابزار در بسیاری از شرکت‌ها از جمله DigitalOcean، Ericsson، CoreOS، Weaveworks، Red Hat و Google در حال استفاده است.

---
#### چرا Prometheus ؟
- **جمع‌آوری داده‌های دقیق و زمان‌بندی شده:** پرومتئوس داده‌ها را به صورت سری‌های زمانی (Time Series) جمع‌آوری می‌کند. این بدان معناست که شما می‌توانید تغییرات عملکرد سیستم را در طول زمان مشاهده کرده و روندها را شناسایی کنید.
- **هشدارهای به‌موقع:** با تعریف آستانه‌های مشخص برای متریک‌های مختلف، پرومتئوس می‌تواند در صورت بروز هرگونه مشکل یا انحراف از حالت نرمال، هشدارهایی را برای شما ارسال کند. این امر به شما امکان می‌دهد تا قبل از وقوع مشکلات جدی، اقدامات لازم را انجام دهید.
- ---
- **انعطاف‌پذیری بالا:** پرومتئوس یک سیستم بسیار انعطاف‌پذیر است و می‌توان آن را برای مانیتورینگ طیف گسترده‌ای از سیستم‌ها و اپلیکیشن‌ها، از جمله زیرساخت‌های ابری، پایگاه‌های داده، سیستم‌های توزیع‌شده و ... پیکربندی کرد.
- **جامعه بزرگ و فعال:** پرومتئوس یک پروژه متن‌باز است و یک جامعه بزرگ از توسعه‌دهندگان و کاربران آن را پشتیبانی می‌کنند. این بدان معناست که شما به راحتی می‌توانید به منابع و اطلاعات مورد نیاز خود دسترسی پیدا کنید.
---
#### چه داده‌هایی را می‌توان با Prometheus مانیتور کرد؟

- **مصرف منابع سیستمی:** CPU، حافظه، دیسک، شبکه و ...
- **عملکرد اپلیکیشن‌ها:** زمان پاسخگویی، تعداد درخواست‌ها، خطاها و ...
- **سلامت سرویس‌ها:** وضعیت سرویس‌ها، زمان آپتایم، زمان داون‌تایم و ...
- **متریک‌های سفارشی:** شما می‌توانید متریک‌های سفارشی خود را تعریف کرده و آن‌ها را مانیتور کنید.
---
 ### چه زمانی از پرومتئوس استفاده کنیم؟
اگر به دنبال یک سیستم مانیتورینگ قدرتمند، انعطاف‌پذیر و متن‌باز هستید، پرومتئوس انتخاب بسیار مناسبی برای شما خواهد بود. پرومتئوس به ویژه برای محیط‌های ابری و میکروسرویس‌ها بسیار مناسب است.
**در کل، پرومتئوس ابزاری است که به شما کمک می‌کند تا از عملکرد صحیح و بهینه سیستم‌های خود اطمینان حاصل کرده و در صورت بروز هرگونه مشکل، به سرعت آن را شناسایی و برطرف کنید.**

---
#### سری‌های زمانی (Time Series) چیست؟
**سری‌های زمانی** مجموعه‌ای از داده‌ها هستند که در بازه‌های زمانی مشخص جمع‌آوری شده‌اند. به عبارت ساده‌تر، هر داده‌ای که در طول زمان تغییر می‌کند و با یک برچسب زمانی همراه است، یک سری زمانی تشکیل می‌دهد.

---
**مثال‌های سری‌های زمانی:**
- **داده‌های مالی:** قیمت سهام، نرخ ارز، حجم معاملات
- **داده‌های حسگرها:** دما، رطوبت، فشار
- **داده‌های شبکه:** ترافیک شبکه، تعداد درخواست‌ها
- **داده‌های عملکرد سیستم:** مصرف CPU، حافظه، دیسک
- **داده‌های فروش:** میزان فروش محصولات در طول زمان
---
**چرا سری‌های زمانی مهم هستند؟**
- **تشخیص الگوها و روندها:** با تحلیل سری‌های زمانی می‌توان الگوهای تکراری، روندهای صعودی یا نزولی و تغییرات فصلی را شناسایی کرد.
- **پیش‌بینی آینده:** با استفاده از مدل‌های پیش‌بینی، می‌توان بر اساس داده‌های گذشته، مقادیر آینده یک سری زمانی را تخمین زد.
- **آشکارسازی ناهنجاری‌ها:** می‌توان از سری‌های زمانی برای تشخیص رویدادهای غیرعادی و ناهنجاری‌ها استفاده کرد.
- **بهینه‌سازی فرآیندها:** با تحلیل سری‌های زمانی می‌توان فرآیندهای مختلف را بهبود بخشید و عملکرد سیستم‌ها را افزایش داد.
---
**ویژگی‌های کلیدی سری‌های زمانی:**
- **ترتیب زمانی:** داده‌ها به ترتیب زمانی مرتب شده‌اند.
- **برچسب زمانی:** هر داده با یک برچسب زمانی مشخص همراه است.
- **وابستگی:** داده‌های مجاور در زمان معمولاً با هم همبستگی دارند.
- **نویز:** داده‌های سری زمانی ممکن است حاوی نویز و خطا باشند.
---
**کاربردهای سری‌های زمانی در پرومتئوس**
در نرم‌افزار پرومتئوس، سری‌های زمانی برای ذخیره و نمایش داده‌های مانیتورینگ استفاده می‌شوند. هر متریک که توسط پرومتئوس جمع‌آوری می‌شود، در واقع یک سری زمانی است که شامل مقدار متریک و برچسب زمانی آن است. با استفاده از زبان پرس‌وجوی قدرتمند PromQL، می‌توان به راحتی سری‌های زمانی را فیلتر، تجزیه و تحلیل و نمایش داد.

---
## متریک (Metric) چیست؟
**متریک** در دنیای مانیتورینگ و به خصوص در ابزارهایی مانند پرومتئوس، به هر عددی گفته می‌شود که یک جنبه قابل اندازه‌گیری از یک سیستم، اپلیکیشن یا سرویس را نشان می‌دهد. این اعداد می‌توانند هر چیزی از میزان مصرف CPU و حافظه گرفته تا تعداد درخواست‌های HTTP و زمان پاسخگویی یک سرویس را شامل شوند.
**به عبارت ساده‌تر، متریک یک عدد است که به شما می‌گوید یک سیستم در حال حاضر چه کار می‌کند.**

---
#### چرا متریک‌ها مهم هستند؟
- **مانیتورینگ عملکرد:** با استفاده از متریک‌ها می‌توانید عملکرد سیستم خود را به صورت لحظه‌ای و تاریخی زیر نظر داشته باشید.
- **تشخیص مشکلات:** متریک‌ها به شما کمک می‌کنند تا مشکلات و ناهنجاری‌ها را در سیستم خود شناسایی کنید.
- **بهینه‌سازی عملکرد:** با تحلیل متریک‌ها می‌توانید نقاط ضعف سیستم خود را شناسایی کرده و برای بهبود عملکرد آن اقدام کنید.
- **گزارش‌گیری:** می‌توانید از متریک‌ها برای ایجاد گزارش‌های مختلف و تحلیل روندهای تغییرات استفاده کنید.
---
### مثال‌هایی از متریک‌ها:
- **متریک‌های سیستم:** مصرف CPU، میزان حافظه آزاد، فضای دیسک، میزان پهنای باند مصرف شده
- **متریک‌های اپلیکیشن:** تعداد درخواست‌های HTTP، زمان پاسخگویی، تعداد خطاها، میزان حافظه مصرف شده توسط اپلیکیشن
- **متریک‌های کسب‌وکار:** تعداد کاربران فعال، درآمد، میزان تبدیل
---
### متریک‌ها در پرومتئوس

در پرومتئوس، متریک‌ها به صورت سری‌های زمانی ذخیره می‌شوند. این بدان معنی است که برای هر متریک، یک سری از مقادیر در طول زمان ثبت می‌شود. این ویژگی به شما اجازه می‌دهد تا تغییرات یک متریک را در طول زمان مشاهده کرده و روندهای آن را تحلیل کنید.

---
**ویژگی‌های کلیدی متریک‌ها در پرومتئوس:**
- **نام:** هر متریک یک نام منحصر به فرد دارد که آن را از سایر متریک‌ها متمایز می‌کند.
- ‏**Label‌ها:** Label‌ها به شما اجازه می‌دهند تا متریک‌ها را بر اساس ویژگی‌های مختلف فیلتر و گروه‌بندی کنید.
- **مقدار:** مقدار عددی متریک در یک زمان خاص.
- **زمان:** زمان ثبت مقدار متریک.
---
**مثالی از یک متریک در پرومتئوس:**
```
node_cpu_seconds_total{mode="idle",instance="localhost"} 12345.67
```
در این مثال:
- ‏`node_cpu_seconds_total`: نام متریک است.
-‏ `{mode="idle",instance="localhost"}`: Label‌های این متریک هستند که نشان می‌دهند این داده مربوط به حالت بیکار CPU یک سرور محلی است.
- `12345.67`: مقدار متریک است که نشان می‌دهد CPU در حالت بیکار بوده است.
---
**جمع‌بندی:** متریک‌ها ستون فقرات مانیتورینگ هستند و به شما کمک می‌کنند تا درک عمیقی از سیستم‌های خود به دست آورید. در پرومتئوس، متریک‌ها به همراه Label‌ها و سری‌های زمانی، یک سیستم قدرتمند برای جمع‌آوری، ذخیره و تحلیل داده‌های مانیتورینگ را تشکیل می‌دهند.

---
### انواع داده در پرومتئوس (Prometheus Data Types)
پرومتئوس از چهار نوع داده اصلی برای ذخیره و نمایش متریک‌ها استفاده می‌کند. هر کدام از این نوع‌ها برای نمایش یک نوع خاص از داده طراحی شده‌اند. در ادامه به بررسی هر کدام می‌پردازیم:

---
### ۱. Counter 
- **تعریف:** نوعی متریک است که به صورت مونوتونیک افزایش می‌یابد و هرگز کاهش نمی‌یابد.
- **کاربرد:** برای شمارش رویدادهایی مانند تعداد درخواست‌ها، خطاها یا تعداد بایت‌های منتقل شده استفاده می‌شود.
- **مثال:** `http_requests_total` که تعداد کل درخواست‌های HTTP را شمارش می‌کند.
- **ویژگی:** برای بازنشانی یک شمارنده، باید سرور یا سرویس مربوطه مجدداً راه‌اندازی شود.

---
### ۲. Gauge 
- **تعریف:** متریک‌هایی هستند که می‌توانند افزایش یا کاهش یابند و نشان‌دهنده یک مقدار در یک لحظه خاص هستند.
- **کاربرد:** برای نمایش متریک‌هایی مانند استفاده از CPU، حافظه، دمای سیستم و ... استفاده می‌شود.
- **مثال:** `cpu_temperature` که دمای CPU را نشان می‌دهد.

---
### ۳. Histogram 
- **تعریف:** برای اندازه‌گیری توزیع یک مجموعه داده استفاده می‌شود. به طور معمول برای اندازه‌گیری زمان پاسخ، اندازه درخواست‌ها و ... استفاده می‌شود.
- **کاربرد:** با استفاده از هیستوگرام می‌توان به اطلاعاتی مانند میانگین، انحراف استاندارد، صدک‌ها و ... دست یافت.
- **مثال:** `http_request_duration_seconds` که زمان پاسخ درخواست‌های HTTP را اندازه‌گیری می‌کند.

---
### ۴. Summary 
- **تعریف:** شبیه به هیستوگرام است اما به جای ذخیره تعداد نمونه‌ها در هر سطل، مقادیر نمونه‌ها را ذخیره می‌کند و از این مقادیر برای محاسبه آماره‌هایی مانند حداقل، حداکثر، میانگین، و صدک‌ها استفاده می‌کند.
- **کاربرد:** زمانی که نیاز به محاسبه دقیق‌تر آماره‌ها باشد، از Summary استفاده می‌شود.
---
**انتخاب نوع داده مناسب:**
- ‏**Counter:** برای شمارش رویدادهای غیرقابل برگشت
- ‏**Gauge:** برای اندازه‌گیری مقادیر متغیر در زمان
- ‏**Histogram:** برای اندازه‌گیری توزیع داده‌ها
- ‏**Summary:** برای محاسبه دقیق آماره‌ها

---
**نکات مهم:**
- **برچسب‌ها (Labels):** به هر متریک می‌توان برچسب‌هایی اضافه کرد تا داده‌ها را بر اساس ابعاد مختلف فیلتر و گروه‌بندی کرد.
- ‏**PromQL:** زبان پرس‌وجوی قدرتمند پرومتئوس برای تجزیه و تحلیل داده‌های سری زمانی است.
- ‏**Grafana:** یک ابزار محبوب برای تجسم داده‌های پرومتئوس است.

**در انتخاب نوع داده مناسب، باید به ماهیت داده‌ها و نوع تحلیل مورد نظر توجه کرد.**

---

#### ‏Label (Label) در Prometheus: کلیدی برای سازماندهی و فیلتر کردن داده‌ها
در دنیای پرومتئوس، **Label** (Label) یک عنصر بسیار مهم است که به شما کمک می‌کند تا داده‌های متریک را سازماندهی، فیلتر و تجزیه و تحلیل کنید. به عبارت ساده‌تر، Label‌ها مانند تگ‌هایی هستند که به هر داده متریک اختصاص داده می‌شوند و اطلاعات اضافی درباره آن داده را ارائه می‌دهند.

---
### چرا Label‌ها مهم هستند؟
- **سازماندهی داده‌ها:** با استفاده از Label‌ها می‌توانید داده‌های متریک را بر اساس ویژگی‌های مختلف مانند محیط (production، staging)، سرویس، سرور، منطقه و ... گروه‌بندی کنید.
- **فیلتر کردن داده‌ها:** می‌توانید با استفاده از عبارات پرس‌و‌جوی PromQL، داده‌های متریک را بر اساس Label‌های خاص فیلتر کنید.
- **ایجاد داشبوردهای سفارشی:** Label‌ها به شما امکان می‌دهند تا داشبوردهای گرافیکی را به گونه‌ای طراحی کنید که اطلاعات مورد نیاز شما را به صورت دقیق و خلاصه نشان دهند.

---
### ساختار یک Label

یک Label از دو بخش تشکیل شده است:
- **نام Label:** یک رشته متنی منحصر به فرد که نوع اطلاعات را مشخص می‌کند (مثلاً: environment، instance، job).
- **مقدار Label:** یک رشته متنی که مقدار خاص آن Label را برای یک داده متریک مشخص می‌کند (مثلاً: production، localhost، node_exporter).

---
**مثال:**
```
node_cpu_seconds_total{mode="idle",instance="localhost"} 12345.67
```
در این مثال:
- ‏`node_cpu_seconds_total`: نام متریک است.
- ‏`{mode="idle",instance="localhost"}`: مجموعه Label‌های این متریک است.
- ‏`mode="idle"`: یک Labelی است که نشان می‌دهد این داده مربوط به حالت بیکار CPU است.
- ‏`instance="localhost"`: یک Labelی است که نشان می‌دهد این داده از سرور local جمع‌آوری شده است.
---
### کاربردهای Label‌ها

- **ایجاد سلسله مراتب:** با استفاده از چندین Label، می‌توانید سلسله مراتب‌های پیچیده‌ای برای سازماندهی داده‌های خود ایجاد کنید.
- **تخصیص منابع:** می‌توانید از Label‌ها برای تخصیص منابع به بخش‌های مختلف سیستم استفاده کنید.
- **تحلیل عملکرد:** می‌توانید با استفاده از Label‌ها، عملکرد بخش‌های مختلف سیستم را با هم مقایسه کنید.
- **ایجاد هشدارهای سفارشی:** می‌توانید هشدارهایی را بر اساس مقادیر خاصی از Label‌ها ایجاد کنید.

### مثال‌های دیگر از Label‌ها:

- ‏`job="nginx"`: برای شناسایی متریک‌های مربوط به وب سرور Nginx
- ‏`environment="production"`: برای شناسایی متریک‌های مربوط به محیط تولید
- ‏`datacenter="eu-central-1"`: برای شناسایی متریک‌های مربوط به یک دیتاسنتر خاص

---
### جمع‌بندی Label‌ها
‏Label‌ها در پرومتئوس ابزاری قدرتمند برای سازماندهی، فیلتر کردن و تجزیه و تحلیل داده‌های متریک هستند. با استفاده صحیح از Label‌ها، می‌توانید به بینش‌های عمیقی درباره عملکرد سیستم خود دست پیدا کنید و مشکلات را به سرعت شناسایی و برطرف کنید.
- ‏**PromQL:** زبان پرس‌و‌جوی قدرتمندی که برای کار با Label‌ها استفاده می‌شود.
- **داشبوردهای Grafana:** نحوه استفاده از Label‌ها برای ایجاد داشبوردهای سفارشی در Grafana.
- **بهترین روش‌ها برای استفاده از Label‌ها:** توصیه‌هایی برای استفاده موثر از Label‌ها در محیط‌های تولید.




-------------

## تفاوت مدل‌های Push و Pull در سیستم‌های جمع‌آوری داده

در دنیای سیستم‌های جمع‌آوری داده، به خصوص در حوزه مانیتورینگ، دو مدل اصلی برای انتقال داده‌ها وجود دارد: **Push** و **Pull**. هر کدام از این مدل‌ها مزایا و معایب خاص خود را دارند و انتخاب بین آن‌ها به عوامل مختلفی مانند نوع داده، حجم داده، الزامات زمانی و معماری سیستم بستگی دارد.

---

![image](pushVsPull.png)
---
### مدل Push 

- **مفهوم:** در این مدل، داده‌ها به صورت فعال از منبع داده به سمت یک جمع‌آوری‌کننده یا مخزن مرکزی ارسال می‌شوند.
- **نحوه کار:** منبع داده (مثلاً یک دستگاه، اپلیکیشن یا سرویس) به صورت دوره‌ای یا بر اساس رخدادهای خاص، داده‌ها را به یک نقطه مرکزی ارسال می‌کند.
---
- **مزایا:**
    - **سادگی:** پیاده‌سازی آن ساده‌تر است، زیرا منبع داده تنها نیاز به ارسال داده‌ها دارد.
    - **کنترل بیشتر در منبع داده:** منبع داده می‌تواند بر زمان ارسال داده‌ها و حجم آن‌ها کنترل بیشتری داشته باشد.
- **معایب:**
    - **بارگذاری روی منبع داده:** اگر حجم داده زیاد باشد، ارسال مداوم داده‌ها می‌تواند به منبع داده فشار وارد کند.
    - **وابستگی به شبکه:** اگر ارتباط شبکه‌ای بین منبع داده و جمع‌آوری‌کننده قطع شود، داده‌ها از دست می‌روند.
    - **مدیریت پیچیده در سیستم‌های بزرگ:** با افزایش تعداد منابع داده، مدیریت ارسال داده‌ها پیچیده‌تر می‌شود.
---
### مدل Pull 

- **مفهوم:** در این مدل، یک جمع‌آوری‌کننده به صورت دوره‌ای به منابع داده متصل شده و داده‌های مورد نیاز را از آن‌ها دریافت می‌کند.
- **نحوه کار:** جمع‌آوری‌کننده با استفاده از یک پروتکل مشخص (مثلاً HTTP) به منابع داده درخواست داده می‌دهد و منابع داده پاسخ درخواست را ارسال می‌کنند.
---
- **مزایا:**
    - **کنترل مرکزی:** تمام عملیات جمع‌آوری داده در یک نقطه مرکزی مدیریت می‌شود.
    - **انعطاف‌پذیری بیشتر:** می‌توان به راحتی منابع داده جدیدی را اضافه یا حذف کرد.
    - **کاهش بار روی منابع داده:** منابع داده تنها زمانی که درخواست داده می‌شوند، نیاز به پردازش دارند.
- **معایب:**
    - **تأخیر:** ممکن است بین زمانی که داده‌ای تولید می‌شود و زمانی که توسط جمع‌آوری‌کننده دریافت می‌شود، تأخیر وجود داشته باشد.
    - **وابستگی به دسترس‌پذیری جمع‌آوری‌کننده:** اگر جمع‌آوری‌کننده از دسترس خارج شود، داده‌ها جمع‌آوری نمی‌شوند.

---
### مقایسه مدل‌های Push و Pull

|ویژگی|مدل Push|مدل Pull|
|---|---|---|
|**فعالیت**|منبع داده فعال است|جمع‌آوری‌کننده فعال است|
|**کنترل**|منبع داده|جمع‌آوری‌کننده|
|**پیچیدگی پیاده‌سازی**|ساده‌تر|پیچیده‌تر|
|**بارگذاری روی منبع داده**|بیشتر|کمتر|
|**وابستگی به شبکه**|بیشتر|کمتر|
|**انعطاف‌پذیری**|کمتر|بیشتر|
|**تأخیر**|کمتر|بیشتر|

---

### انتخاب مدل مناسب

انتخاب بین مدل Push و Pull به عوامل مختلفی بستگی دارد، از جمله:
- **نوع داده:** برای داده‌های با حجم کم و نیاز به زمان پاسخگویی کم، مدل Push مناسب‌تر است. برای داده‌های با حجم زیاد و نیاز به کنترل مرکزی، مدل Pull مناسب‌تر است.
- **فرکانس جمع‌آوری داده:** اگر نیاز به جمع‌آوری داده‌ها با فرکانس بالا باشد، مدل Push ممکن است مناسب‌تر باشد.
- **تعداد منابع داده:** برای تعداد زیاد منابع داده، مدل Pull به دلیل مدیریت مرکزی ساده‌تر است.
- **نیازمندی‌های زمانی:** اگر نیاز به دریافت داده‌ها به صورت بلادرنگ باشد، مدل Push مناسب‌تر است.
**در پرومتئوس** به طور پیش‌فرض از مدل Pull استفاده می‌شود. این بدان معنی است که پرومتئوس سرور به صورت دوره‌ای به منابع داده متصل شده و داده‌ها را جمع‌آوری می‌کند. با این حال، پرومتئوس از طریق یک کامپوننت به نام Pushgateway نیز از مدل Push پشتیبانی می‌کند.


